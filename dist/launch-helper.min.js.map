{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./app/helper-element.js","webpack:///./app/helper.js","webpack:///./app/user.js","webpack:///./app/ica-url.js","webpack:///./app/ica-json.js","webpack:///./app/script-load.js","webpack:///./app/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","helper_element_element","helper_element","[object Object]","this","_element","document","getElementsByTagName","_config","element","src","url","getAttribute","slice","method","xdApi","api","staticResource","res","window","location","origin","config","_removeIframe","iframe","createElement","setAttribute","appendChild","iframes","removeChild","app_helper","ica","handlers","citrix","receiver","setPath","createSession","_sessionParams","_sessionCreated","bind","e","console","error","launchType","closeOptions","showDisconnectAlert","container","type","id","preferences","ui","toolbar","fileTransfer","about","lock","disconnect","logoff","fullscreen","multitouch","switchApp","appSwitcher","showTaskbar","sessionObject","_sessionCreatedConfig","_startSession","icaJsonObject","JSON","parse","start","addListener","connectionHandler","event","log","data","connectionClosedHandler","onErrorHandler","onURLRedirectionHandler","app_user","user","customer","cwcCustomerId","_customer","token","cwcBearerToken","_bearerToken","ica_url","_xenDesktopApi","replace","ica_json","icaAsync","_fetchIcaJson","then","options","headers","Authorization","content-type","toLowerCase","body","stringify","SessionId","cwcSessionId","response","fetch","json","script_load","script","callback","_url","_callback","onreadystatechange","onload","launchHelper","loadCitrixSDKPromise","Promise","resolve","loadScript","getIcaJsonPromise","all","results","appendIframe","catch","err"],"mappings":"aACA,IAAAA,KAGA,SAAAC,EAAAC,GAGA,GAAAF,EAAAE,GACA,OAAAF,EAAAE,GAAAC,QAGA,IAAAC,EAAAJ,EAAAE,IACAG,EAAAH,EACAI,GAAA,EACAH,YAUA,OANAI,EAAAL,GAAAM,KAAAJ,EAAAD,QAAAC,IAAAD,QAAAF,GAGAG,EAAAE,GAAA,EAGAF,EAAAD,QAKAF,EAAAQ,EAAAF,EAGAN,EAAAS,EAAAV,EAGAC,EAAAU,EAAA,SAAAR,EAAAS,EAAAC,GACAZ,EAAAa,EAAAX,EAAAS,IACAG,OAAAC,eAAAb,EAAAS,GACAK,cAAA,EACAC,YAAA,EACAC,IAAAN,KAMAZ,EAAAmB,EAAA,SAAAjB,GACAY,OAAAC,eAAAb,EAAA,cAAiDkB,OAAA,KAIjDpB,EAAAqB,EAAA,SAAAlB,GACA,IAAAS,EAAAT,KAAAmB,WACA,WAA2B,OAAAnB,EAAA,SAC3B,WAAiC,OAAAA,GAEjC,OADAH,EAAAU,EAAAE,EAAA,IAAAA,GACAA,GAIAZ,EAAAa,EAAA,SAAAU,EAAAC,GAAsD,OAAAV,OAAAW,UAAAC,eAAAnB,KAAAgB,EAAAC,IAGtDxB,EAAA2B,EAAA,GAIA3B,IAAA4B,EAAA,yCClBA,IAAAC,EAAA,KAEA,IAAAC,EAAA,WACA,OAAAD,MAAA,UAnDAE,cACAC,KAAAC,SAAAC,SAAAC,qBAAA,oBACAH,KAAAI,QAAA,KAGAC,cACA,OAAAL,KAAAC,SAGAK,UACA,MAAAC,EAAAP,KAAAC,SAAAO,aAAA,QAAAR,KAAAI,SAAAJ,KAAAI,QAAAE,IAEA,YAAAC,EAAA,GAAAA,EAAAE,MAAA,GAAAF,EAGAG,aACA,OAAAV,KAAAC,SAAAO,aAAA,WAAAR,KAAAI,SAAAJ,KAAAI,QAAAM,QAAA,MAGAC,YACA,OAAAX,KAAAC,SAAAO,aAAA,QAAAR,KAAAI,SAAAJ,KAAAI,QAAAQ,IAGAC,qBACA,OAAAb,KAAAC,SAAAO,aAAA,QAAAR,KAAAI,SAAAJ,KAAAI,QAAAU,KAAAC,OAAAC,SAAAC,OAGAC,WAAAzC,GACAuB,KAAAI,QAAA3B,EAGAsB,eACAC,KAAAmB,gBACA,MAAAC,EAAAlB,SAAAmB,cAAA,UACAD,EAAAE,aAAA,eACAF,EAAAE,aAAA,gBACAF,EAAAE,aAAA,iBACAtB,KAAAC,SAAAsB,YAAAH,GAGArB,gBACA,MAAAyB,EAAAxB,KAAAC,SAAAE,qBAAA,UACA,UAAAiB,KAAAI,EACAxB,KAAAC,SAAAwB,YAAAL,OCqDA,IAAAM,QA7FA3B,YAAA4B,EAAAC,GACA5B,KAAA2B,MACA3B,KAAA4B,WAGA7B,gBACA,MAAA8B,EAAAd,OAAAc,OACA,IACAA,EAAAC,SAAAC,WAAuCjC,EAAAe,uCACvCgB,EAAAC,SAAAE,cAAA,KAAAhC,KAAAiC,eAAAjC,KAAAkC,gBAAAC,KAAAnC,OACS,MAAAoC,GACTC,QAAAC,MAAAF,IAIAH,qBACA,OACAM,WAAA,QACAC,cAA2BC,qBAAA,GAG3BC,WACAC,KAAA,SACAC,GAAA,UAEAC,aACAC,IACAC,SACAC,cAAA,EACAC,OAAA,EACAC,MAAA,EACAC,YAAA,EACAC,QAAA,EACAC,YAAA,EACAC,YAAA,EACAC,WAAA,EACAV,aAAA,GAEAW,aACAC,aAAA,MAOA1D,gBAAA2D,GACA1D,KAAA2D,sBAAAD,GACA1D,KAAA4D,cAAAF,GAGA3D,cAAA2D,GACA,MACAG,GACAlB,KAAA,OACAvD,MAHA,iBAAAY,KAAA2B,IAAAmC,KAAAC,MAAA/D,KAAA2B,KAAA3B,KAAA2B,KAMA+B,EAAAM,MAAAH,GAGA9D,sBAAA2D,GAOAA,EAAAO,YAAA,eAAAjE,KAAA4B,UAAA5B,KAAA4B,SAAAsC,mBAJA,SAAAC,GACA9B,QAAA+B,IAAA,oBAAAD,EAAAxB,MACAN,QAAA+B,IAAAD,EAAAE,QASAX,EAAAO,YAAA,qBAAAjE,KAAA4B,UAAA5B,KAAA4B,SAAA0C,yBAJA,SAAAH,GACA9B,QAAA+B,IAAA,oBAAAD,EAAAxB,MACAN,QAAA+B,IAAAD,EAAAE,QASAX,EAAAO,YAAA,UAAAjE,KAAA4B,UAAA5B,KAAA4B,SAAA2C,gBAJA,SAAAJ,GACA9B,QAAA+B,IAAA,oBAAAD,EAAAxB,MACAN,QAAA+B,IAAAD,EAAAE,QASAX,EAAAO,YAAA,mBAAAjE,KAAA4B,UAAA5B,KAAA4B,SAAA4C,yBAJA,SAAAL,GACA9B,QAAA+B,IAAA,oBAAAD,EAAAxB,MACAN,QAAA+B,IAAAD,EAAAE,UCxEA,IAAAI,EAFA,UAhBAC,WACA,OACAC,SAAA5D,OAAA6D,eAAA5E,KAAA6E,WAAA,aACAC,MAAA/D,OAAAgE,gBAAA/E,KAAAgF,cAIAA,oBAIAH,mBCCA,IAAAI,QATA1E,UACA,SAAkBP,KAAAkF,kBAAuBpF,IAAAQ,MAGzC4E,qBACA,OAAApF,IAAAa,MAAAwE,QAAA,aAAAV,EAAAC,KAAAC,YCsBA,IAAAS,QA1BAC,eACA,OAAArF,KAAAsF,gBAAAC,KAAA5D,MAGA5B,sBACA,MAAAW,EAAAZ,IAAAY,OAEA8E,GACA9E,SACA+E,SACAC,gCAAiDjB,EAAAC,KAAAI,QACjDa,eAAA,qBAIA,SAAAjF,EAAAkF,gBACAJ,EAAAK,KAAA/B,KAAAgC,WACAC,UAAAhF,OAAAiF,gBAIA,MAAAC,QAAAC,OAAA,IAAAjB,GAAA1E,IAAAiF,GACA,aAAAS,EAAAE,SCVA,IAAAC,QAhBArG,YAAAsG,EAAAC,GACAtG,KAAAuG,KAAAF,EACArG,KAAAwG,UAAAF,EAGAvG,aACA,MAAAsG,EAAAnG,SAAAmB,cAAA,UACAgF,EAAA1D,KAAA,kBACA0D,EAAA/F,IAAAN,KAAAuG,KACAF,EAAAI,mBAAAzG,KAAAwG,UACAH,EAAAK,OAAA1G,KAAAwG,UAEAtG,SAAA2F,KAAAtE,YAAA8E,KCRAtF,OAAA4F,aAAA,SAAA/E,EAAAV,GACApB,IAAAoB,SAEA,MAAA0F,EAAA,IAAAC,QAAAC,IACA,IAAAV,KAA0BtG,IAAAe,mCAA+B,KACzDiG,MACSC,eAGTC,GAAA,IAAA5B,GAAAC,SAEAwB,QAAAI,KAAAL,EAAAI,IACAzB,KAAA2B,IACA,MAAAvF,EAAAuF,EAAA,GACApH,IAAAqH,eAEA,IAAAzF,EAAAC,EAAAC,GACAI,kBACSoF,MAAAC,IACThF,QAAA+B,IAAAiD","file":"launch-helper.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","class HelperElement {\r\n    constructor() {\r\n        this._element = document.getElementsByTagName('launch-helper')[0];\r\n        this._config = null;\r\n    }\r\n\r\n    get element() {\r\n        return this._element;\r\n    }\r\n\r\n    get src() {\r\n        const url = this._element.getAttribute('src') || (this._config && this._config.src);\r\n\r\n        return url[0] === '/' ? url.slice(1) : url;\r\n    }\r\n\r\n    get method() {\r\n        return this._element.getAttribute('method') || (this._config && this._config.method) || 'GET';\r\n    }\r\n\r\n    get xdApi() {\r\n        return this._element.getAttribute('api') || (this._config && this._config.api);\r\n    }\r\n\r\n    get staticResource() {\r\n        return this._element.getAttribute('res') || (this._config && this._config.res) || window.location.origin;\r\n    }\r\n\r\n    set config(c) {\r\n        this._config = c;\r\n    }\r\n\r\n    appendIframe() {\r\n        this._removeIframe();\r\n        const iframe = document.createElement('iframe');\r\n        iframe.setAttribute('id', 'studio');\r\n        iframe.setAttribute('width', '100%');\r\n        iframe.setAttribute('height', '100%');\r\n        this._element.appendChild(iframe);\r\n    }\r\n\r\n    _removeIframe() {\r\n        const iframes = this._element.getElementsByTagName('iframe');\r\n        for (const iframe of iframes) {\r\n            this._element.removeChild(iframe);\r\n        }\r\n    }\r\n}\r\n\r\nlet element = null;\r\n\r\nexport default function () {\r\n    return element || (element = new HelperElement());   \r\n};\r\n","import HelperElement from './helper-element.js';\r\n\r\nclass Helper {\r\n\r\n    constructor (ica, handlers) {\r\n        this.ica = ica;\r\n        this.handlers = handlers;\r\n    }\r\n\r\n    createSession() {\r\n        const citrix = window.citrix;\r\n        try {\r\n            citrix.receiver.setPath(`${HelperElement.staticResource}/external/HTML5Client`);\r\n            citrix.receiver.createSession(null, this._sessionParams, this._sessionCreated.bind(this));\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    get _sessionParams() {\r\n        return {\r\n            launchType: 'embed',\r\n            closeOptions: { showDisconnectAlert: false },\r\n            // TBD : set preferredLang based on the admin's language selection in CC, which is available in a cookie\r\n            //preferredLang: { },\r\n            container: {\r\n                type: 'iframe',\r\n                id: 'studio'\r\n            },\r\n            preferences: {\r\n                ui: {\r\n                    toolbar: {\r\n                        fileTransfer: false,\r\n                        about: false,\r\n                        lock: false,\r\n                        disconnect: false,\r\n                        logoff: true,\r\n                        fullscreen: false,\r\n                        multitouch: false,\r\n                        switchApp: false,\r\n                        preferences: false\r\n                    },\r\n                    appSwitcher: {\r\n                        showTaskbar: false\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    _sessionCreated(sessionObject) {\r\n        this._sessionCreatedConfig(sessionObject);\r\n        this._startSession(sessionObject);  \r\n    }\r\n\r\n    _startSession(sessionObject) {\r\n        const icaJson = typeof this.ica === 'string' ? JSON.parse(this.ica) : this.ica;\r\n        const icaJsonObject = {\r\n            type: 'json',\r\n            value: icaJson\r\n        };\r\n    \r\n        sessionObject.start(icaJsonObject);\r\n    }\r\n\r\n    _sessionCreatedConfig(sessionObject) {\r\n        //Handle session interactions like events, start, disconnect here.              \r\n        // Adding onConnection event handler\r\n        function connectionHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onConnection', (this. handlers && this.handlers.connectionHandler) || connectionHandler);\r\n        \r\n        // Adding onConnectionClosed event handler\r\n        function connectionClosedHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onConnectionClosed', (this. handlers && this.handlers.connectionClosedHandler) || connectionClosedHandler);\r\n    \r\n        // Adding onError event handler\r\n        function onErrorHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onError', (this. handlers && this.handlers.onErrorHandler) || onErrorHandler);\r\n    \r\n        //Adding onURLRedirection event handler\r\n        function onURLRedirectionHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onURLRedirection', (this. handlers && this.handlers.onURLRedirectionHandler) || onURLRedirectionHandler);  \r\n    }\r\n}\r\n\r\nexport default Helper;\r\n","class User {\r\n    get user() {\r\n        return {\r\n            customer: window.cwcCustomerId || this._customer || 'studiopool',\r\n            token: window.cwcBearerToken || this._bearerToken\r\n        };\r\n    };\r\n    \r\n    get _bearerToken() {\r\n        // TODO: fetch bearer token from API\r\n    }\r\n    \r\n    get _customer () {\r\n        // TODO: fetch customer id from API\r\n    }\r\n}\r\n\r\nconst user = new User();\r\n\r\nexport default user;","import userInstance from './user.js';\r\nimport HelperElement from './helper-element.js';\r\n\r\nclass IcaUrl {\r\n    get url() {\r\n        return `${this._xenDesktopApi}/${HelperElement().src}`;\r\n    }\r\n\r\n    get _xenDesktopApi() {\r\n        return HelperElement().xdApi.replace('[customer]', userInstance.user.customer);\r\n    }\r\n}\r\n\r\nexport default IcaUrl;\r\n","import userInstance from './user.js';\r\nimport IcaUrl from './ica-url.js';\r\nimport HelperElement from './helper-element.js';\r\n\r\nclass IcaJson {\r\n    get icaAsync() {\r\n        return this._fetchIcaJson().then(ica => ica);\r\n    }\r\n\r\n    async _fetchIcaJson() {\r\n        const method = HelperElement().method;\r\n\r\n        const options = {\r\n            method: method,\r\n            headers: {\r\n                Authorization: `CWSAuth bearer=${userInstance.user.token}`,\r\n                'content-type': 'application/json'\r\n            }\r\n        };\r\n\r\n        if (method.toLowerCase() === 'post') {\r\n            options.body = JSON.stringify({\r\n                SessionId: window.cwcSessionId\r\n            });\r\n        }\r\n\r\n        const response = await fetch(new IcaUrl().url, options);\r\n        return await response.json();\r\n    }\r\n}\r\n\r\nexport default IcaJson;\r\n","class ScriptLoad {\r\n    constructor(script, callback) {\r\n        this._url = script;\r\n        this._callback = callback;\r\n    }\r\n\r\n    loadScript() {\r\n        const script = document.createElement('script');\r\n        script.type = 'text/javascript';\r\n        script.src = this._url;\r\n        script.onreadystatechange = this._callback;\r\n        script.onload = this._callback;\r\n\r\n        document.body.appendChild(script);\r\n    }\r\n}\r\n\r\nexport default ScriptLoad;\r\n","import HelperElement from './helper-element.js';\r\nimport Helper from './helper.js';\r\nimport IcaJson from './ica-json.js';\r\nimport ScriptLoad from './script-load.js';\r\n\r\nwindow.launchHelper = function (handlers, config) {\r\n    HelperElement().config = config;\r\n\r\n    const loadCitrixSDKPromise = new Promise(resolve => {\r\n        new ScriptLoad(`${HelperElement().staticResource}/CitrixHTML5SDK.js`, () => {\r\n            resolve();\r\n        }).loadScript();\r\n    });\r\n    \r\n    const getIcaJsonPromise = new IcaJson().icaAsync;\r\n\r\n    Promise.all([loadCitrixSDKPromise, getIcaJsonPromise])\r\n        .then(results => {\r\n            const ica = results[1];\r\n            HelperElement().appendIframe();\r\n        \r\n            const helper = new Helper(ica, handlers);\r\n            helper.createSession();\r\n        }).catch(err => {\r\n            console.log(err);\r\n        });\r\n};\r\n"],"sourceRoot":""}