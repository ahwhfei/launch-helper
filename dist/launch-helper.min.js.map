{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./app/helper-element.js","webpack:///./app/manifest.js","webpack:///./app/helper.js","webpack:///./app/user.js","webpack:///./app/ica-url.js","webpack:///./app/ica-json.js","webpack:///./app/script-load.js","webpack:///./app/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","helper_element","[object Object]","this","_element","document","getElementsByTagName","element","src","url","getAttribute","slice","method","xdApi","staticResource","_removeIframe","iframe","createElement","setAttribute","appendChild","iframes","removeChild","app_manifest","window","manifest","helperElement","location","origin","app_helper","ica","handlers","citrix","receiver","setPath","createSession","_sessionParams","_sessionCreated","bind","e","console","error","launchType","closeOptions","showDisconnectAlert","container","type","id","preferences","ui","toolbar","fileTransfer","about","lock","disconnect","logoff","fullscreen","multitouch","switchApp","appSwitcher","showTaskbar","sessionObject","_sessionCreatedConfig","_startSession","icaJsonObject","JSON","parse","start","addListener","connectionHandler","event","log","data","connectionClosedHandler","onErrorHandler","onURLRedirectionHandler","app_user","user","customer","cwcCustomerId","_customer","token","cwcBearerToken","_bearerToken","ica_url","_xenDesktopApi","replace","ica_json","icaAsync","_fetchIcaJson","then","options","headers","Authorization","content-type","toLowerCase","body","stringify","SessionId","cwcSessionId","response","fetch","json","script_load","script","callback","_url","_callback","onreadystatechange","onload","launchHelper","loadCitrixSDKPromise","Promise","resolve","loadScript","getIcaJsonPromise","all","results","appendIframe","catch","err"],"mappings":"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","file":"launch-helper.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","class HelperElement {\r\n    constructor() {\r\n        this._element = document.getElementsByTagName('launch-helper')[0];\r\n    }\r\n\r\n    get element() {\r\n        return this._element;\r\n    }\r\n\r\n    get src() {\r\n        const url = this._element.getAttribute('src');\r\n\r\n        return url[0] === '/' ? url.slice(1) : url;\r\n    }\r\n\r\n    get method() {\r\n        return this._element.getAttribute('method') || 'GET';\r\n    }\r\n\r\n    get xdApi() {\r\n        return this._element.getAttribute('api');\r\n    }\r\n\r\n    get staticResource() {\r\n        return this._element.getAttribute('res');\r\n    }\r\n\r\n    appendIframe() {\r\n        this._removeIframe();\r\n        const iframe = document.createElement('iframe');\r\n        iframe.setAttribute('id', 'studio');\r\n        iframe.setAttribute('width', '100%');\r\n        iframe.setAttribute('height', '100%');\r\n        this._element.appendChild(iframe);\r\n    }\r\n\r\n    _removeIframe() {\r\n        const iframes = this._element.getElementsByTagName('iframe');\r\n        for (const iframe of iframes) {\r\n            this._element.removeChild(iframe);\r\n        }\r\n    }\r\n}\r\n\r\nexport default HelperElement;\r\n","import HelperElement from './helper-element.js';\r\n\r\nclass Manifest {\r\n    constructor() {\r\n        window.manifest || (window.manifest = {});\r\n\r\n        const helperElement = new HelperElement();\r\n        this.xdApi = helperElement.xdApi;\r\n        this.staticResource = helperElement.staticResource || window.location.origin;\r\n    }\r\n\r\n    get manifest() {\r\n        return window.manifest;\r\n    }\r\n\r\n    set xdApi(url) {\r\n        window.manifest.xdApi = url;\r\n    }\r\n\r\n    set staticResource(url) {\r\n        window.manifest.staticResource || (window.manifest.staticResource = url);\r\n    }\r\n}\r\n\r\nexport default Manifest;","class Helper {\r\n\r\n    constructor (ica, handlers) {\r\n        this.ica = ica;\r\n        this.handlers = handlers;\r\n    }\r\n\r\n    createSession() {\r\n        const citrix = window.citrix;\r\n        try {\r\n            citrix.receiver.setPath(`${manifest.staticResource}/external/HTML5Client`);\r\n            citrix.receiver.createSession(null, this._sessionParams, this._sessionCreated.bind(this));\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n\r\n    get _sessionParams() {\r\n        return {\r\n            launchType: 'embed',\r\n            closeOptions: { showDisconnectAlert: false },\r\n            // TBD : set preferredLang based on the admin's language selection in CC, which is available in a cookie\r\n            //preferredLang: { },\r\n            container: {\r\n                type: 'iframe',\r\n                id: 'studio'\r\n            },\r\n            preferences: {\r\n                ui: {\r\n                    toolbar: {\r\n                        fileTransfer: false,\r\n                        about: false,\r\n                        lock: false,\r\n                        disconnect: false,\r\n                        logoff: true,\r\n                        fullscreen: false,\r\n                        multitouch: false,\r\n                        switchApp: false,\r\n                        preferences: false\r\n                    },\r\n                    appSwitcher: {\r\n                        showTaskbar: false\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    _sessionCreated(sessionObject) {\r\n        this._sessionCreatedConfig(sessionObject);\r\n        this._startSession(sessionObject);  \r\n    }\r\n\r\n    _startSession(sessionObject) {\r\n        const icaJson = typeof this.ica === 'string' ? JSON.parse(this.ica) : this.ica;\r\n        const icaJsonObject = {\r\n            type: 'json',\r\n            value: icaJson\r\n        };\r\n    \r\n        sessionObject.start(icaJsonObject);\r\n    }\r\n\r\n    _sessionCreatedConfig(sessionObject) {\r\n        //Handle session interactions like events, start, disconnect here.              \r\n        // Adding onConnection event handler\r\n        function connectionHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onConnection', (this. handlers && this.handlers.connectionHandler) || connectionHandler);\r\n        \r\n        // Adding onConnectionClosed event handler\r\n        function connectionClosedHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onConnectionClosed', (this. handlers && this.handlers.connectionClosedHandler) || connectionClosedHandler);\r\n    \r\n        // Adding onError event handler\r\n        function onErrorHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onError', (this. handlers && this.handlers.onErrorHandler) || onErrorHandler);\r\n    \r\n        //Adding onURLRedirection event handler\r\n        function onURLRedirectionHandler(event) {\r\n            console.log('Event Received : ' + event.type);\r\n            console.log(event.data);\r\n        }\r\n        sessionObject.addListener('onURLRedirection', (this. handlers && this.handlers.onURLRedirectionHandler) || onURLRedirectionHandler);  \r\n    }\r\n}\r\n\r\nexport default Helper;\r\n","class User {\r\n    get user() {\r\n        return {\r\n            customer: window.cwcCustomerId || this._customer || 'studiopool',\r\n            token: window.cwcBearerToken || this._bearerToken\r\n        };\r\n    };\r\n    \r\n    get _bearerToken() {\r\n        // TODO: fetch bearer token from API\r\n    }\r\n    \r\n    get _customer () {\r\n        // TODO: fetch customer id from API\r\n    }\r\n}\r\n\r\nconst user = new User();\r\n\r\nexport default user;","import userInstance from './user.js';\r\nimport HelperElement from './helper-element.js';\r\n\r\nclass IcaUrl {\r\n    get url() {\r\n        return `${this._xenDesktopApi}/${new HelperElement().src}`;\r\n    }\r\n\r\n    get _xenDesktopApi() {\r\n        return manifest.xdApi.replace('[customer]', userInstance.user.customer);\r\n    }\r\n}\r\n\r\nexport default new IcaUrl();\r\n","import userInstance from './user.js';\r\nimport IcaUrl from './ica-url.js';\r\nimport HelperElement from './helper-element.js';\r\n\r\nclass IcaJson {\r\n    get icaAsync() {\r\n        return this._fetchIcaJson().then(ica => ica);\r\n    }\r\n\r\n    async _fetchIcaJson() {\r\n        const method = new HelperElement().method;\r\n\r\n        const options = {\r\n            method: method,\r\n            headers: {\r\n                Authorization: `CWSAuth bearer=${userInstance.user.token}`,\r\n                'content-type': 'application/json'\r\n            }\r\n        };\r\n\r\n        if (method.toLowerCase() === 'post') {\r\n            options.body = JSON.stringify({\r\n                SessionId: window.cwcSessionId\r\n            });\r\n        }\r\n\r\n        const response = await fetch(IcaUrl.url, options);\r\n        return await response.json();\r\n    }\r\n}\r\n\r\nexport default IcaJson;\r\n","class ScriptLoad {\r\n    constructor(script, callback) {\r\n        this._url = script;\r\n        this._callback = callback;\r\n    }\r\n\r\n    loadScript() {\r\n        const script = document.createElement('script');\r\n        script.type = 'text/javascript';\r\n        script.src = this._url;\r\n        script.onreadystatechange = this._callback;\r\n        script.onload = this._callback;\r\n\r\n        document.body.appendChild(script);\r\n    }\r\n}\r\n\r\nexport default ScriptLoad;\r\n","import HelperElement from './helper-element.js';\r\nimport Manifest from './manifest.js';\r\nimport Helper from './helper.js';\r\nimport IcaJson from './ica-json.js';\r\nimport ScriptLoad from './script-load.js';\r\n\r\nwindow.launchHelper = function (handlers) {\r\n    const loadCitrixSDKPromise = new Promise(resolve => {\r\n        new ScriptLoad(`${new Manifest().manifest.staticResource}/CitrixHTML5SDK.js`, () => {\r\n            resolve();\r\n        }).loadScript();\r\n    });\r\n    \r\n    const getIcaJsonPromise = new IcaJson().icaAsync;\r\n\r\n    Promise.all([loadCitrixSDKPromise, getIcaJsonPromise])\r\n        .then(results => {\r\n            const ica = results[1];\r\n            const launchHelperElement = new HelperElement();\r\n            launchHelperElement.appendIframe();\r\n        \r\n            const helper = new Helper(ica, handlers);\r\n            helper.createSession();\r\n        }).catch(err => {\r\n            console.log(err);\r\n        });\r\n};\r\n"],"sourceRoot":""}