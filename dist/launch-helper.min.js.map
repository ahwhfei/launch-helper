{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./app/helper-element.js","webpack:///./app/manifest.js","webpack:///./app/helper.js","webpack:///./app/user.js","webpack:///./app/ica-url.js","webpack:///./app/ica-json.js","webpack:///./app/script-load.js","webpack:///./app/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","helper_element","[object Object]","this","_element","document","getElementsByTagName","element","src","url","getAttribute","slice","method","xenDesktopApi","staticResource","_removeIframe","iframe","createElement","setAttribute","appendChild","iframes","removeChild","app_manifest","window","manifest","helperElement","location","origin","app_helper","ica","citrix","receiver","setPath","createSession","_sessionParams","_sessionCreated","bind","e","console","error","launchType","closeOptions","showDisconnectAlert","container","type","id","preferences","ui","toolbar","fileTransfer","about","lock","disconnect","logoff","fullscreen","multitouch","switchApp","appSwitcher","showTaskbar","sessionObject","_sessionCreatedConfig","_startSession","icaJsonObject","JSON","parse","start","addListener","event","log","data","app_user","user","customer","cwcCustomerId","_customer","token","cwcBearerToken","_bearerToken","ica_url","_xenDesktopApi","replace","ica_json","icaAsync","_fetchIcaJson","then","response","fetch","headers","Authorization","json","script_load","script","callback","_url","_callback","onreadystatechange","onload","body","launchHelper","loadCitrixSDKPromise","Promise","resolve","loadScript","getIcaJsonPromise","all","results","appendIframe","catch","err"],"mappings":"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","file":"launch-helper.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","class HelperElement {\n    constructor() {\n        this._element = document.getElementsByTagName('launch-helper')[0];\n    }\n\n    get element() {\n        return this._element;\n    }\n\n    get src() {\n        const url = this._element.getAttribute('src');\n\n        return url[0] === '/' ? url.slice(1) : url;\n    }\n\n    get method() {\n        return this._element.getAttribute('method') || 'GET';\n    }\n\n    get xenDesktopApi() {\n        return this._element.getAttribute('api');\n    }\n\n    get staticResource() {\n        return this._element.getAttribute('res');\n    }\n\n    appendIframe() {\n        this._removeIframe();\n        const iframe = document.createElement('iframe');\n        iframe.setAttribute('id', 'studio');\n        iframe.setAttribute('width', '100%');\n        iframe.setAttribute('height', '100%');\n        this._element.appendChild(iframe);\n    }\n\n    _removeIframe() {\n        const iframes = this._element.getElementsByTagName('iframe');\n        for (const iframe of iframes) {\n            this._element.removeChild(iframe);\n        }\n    }\n}\n\nexport default HelperElement;\n","import HelperElement from './helper-element.js';\n\nclass Manifest {\n    constructor() {\n        window.manifest || (window.manifest = {});\n\n        const helperElement = new HelperElement();\n        this.xenDesktopApi = helperElement.xenDesktopApi;\n        this.staticResource = helperElement.staticResource || window.location.origin;\n    }\n\n    get manifest() {\n        return window.manifest;\n    }\n\n    set xenDesktopApi(url) {\n        window.manifest.xenDesktopApi || (window.manifest.xenDesktopApi = url);\n    }\n\n    set staticResource(url) {\n        window.manifest.staticResource || (window.manifest.staticResource = url);\n    }\n}\n\nexport default Manifest;","class Helper {\n\n    constructor (ica) {\n        this.ica = ica;\n    }\n\n    createSession() {\n        const citrix = window.citrix;\n        try {\n            citrix.receiver.setPath(`${manifest.staticResource}/external/HTML5Client`);\n            citrix.receiver.createSession(null, this._sessionParams, this._sessionCreated.bind(this));\n        } catch (e) {\n            console.error(e);\n        }\n    }\n\n    get _sessionParams() {\n        return {\n            launchType: 'embed',\n            closeOptions: { showDisconnectAlert: false },\n            // TBD : set preferredLang based on the admin's language selection in CC, which is available in a cookie\n            //preferredLang: { },\n            container: {\n                type: 'iframe',\n                id: 'studio'\n            },\n            preferences: {\n                ui: {\n                    toolbar: {\n                        fileTransfer: false,\n                        about: false,\n                        lock: false,\n                        disconnect: false,\n                        logoff: true,\n                        fullscreen: false,\n                        multitouch: false,\n                        switchApp: false,\n                        preferences: false\n                    },\n                    appSwitcher: {\n                        showTaskbar: false\n                    }\n                }\n            }\n        };\n    }\n\n    _sessionCreated(sessionObject) {\n        this._sessionCreatedConfig(sessionObject);\n        this._startSession(sessionObject);  \n    }\n\n    _startSession(sessionObject) {\n        const icaJson = typeof this.ica === 'string' ? JSON.parse(this.ica) : this.ica;\n        const icaJsonObject = {\n            type: 'json',\n            value: icaJson\n        };\n    \n        sessionObject.start(icaJsonObject);\n    }\n\n    _sessionCreatedConfig(sessionObject) {\n        //Handle session interactions like events, start, disconnect here.              \n        // Adding onConnection event handler\n        function connectionHandler(event) {\n            console.log('Event Received : ' + event.type);\n            console.log(event.data);\n        }\n        sessionObject.addListener('onConnection', connectionHandler);\n        \n        // Adding onConnectionClosed event handler\n        function connectionClosedHandler(event) {\n            console.log('Event Received : ' + event.type);\n            console.log(event.data);\n        }\n        sessionObject.addListener('onConnectionClosed', connectionClosedHandler);\n    \n        // Adding onError event handler\n        function onErrorHandler(event) {\n            console.log('Event Received : ' + event.type);\n            console.log(event.data);\n        }\n        sessionObject.addListener('onError', onErrorHandler);\n    \n        //Adding onURLRedirection event handler\n        function onURLRedirectionHandler(event) {\n            console.log('Event Received : ' + event.type);\n            console.log(event.data);\n        }\n        sessionObject.addListener('onURLRedirection', onURLRedirectionHandler);  \n    }\n}\n\nexport default Helper;\n","class User {\n    get user() {\n        return {\n            customer: window.cwcCustomerId || this._customer || 'studiopool',\n            token: window.cwcBearerToken || this._bearerToken\n        };\n    };\n    \n    get _bearerToken() {\n        // TODO: fetch bearer token from API\n    }\n    \n    get _customer () {\n        // TODO: fetch customer id from API\n    }\n}\n\nconst user = new User();\n\nexport default user;","import userInstance from './user.js';\nimport HelperElement from './helper-element.js';\n\nclass IcaUrl {\n    get url() {\n        return `${this._xenDesktopApi}/${new HelperElement().src}`;\n    }\n\n    get _xenDesktopApi() {\n        return manifest.xenDesktopApi.replace('[customer]', userInstance.user.customer);\n    }\n}\n\nexport default new IcaUrl();\n","import userInstance from './user.js';\nimport IcaUrl from './ica-url.js';\nimport HelperElement from './helper-element.js';\n\nclass IcaJson {\n    get icaAsync() {\n        return this._fetchIcaJson().then(ica => ica);\n    }\n\n    async _fetchIcaJson() {\n        const method = new HelperElement().method;\n\n        const response = await fetch(IcaUrl.url, {\n            method: method,\n            headers: {\n                Authorization: `CWSAuth bearer=${userInstance.user.token}`\n            }\n        });\n        return await response.json();\n    }\n}\n\nexport default IcaJson;\n","class ScriptLoad {\n    constructor(script, callback) {\n        this._url = script;\n        this._callback = callback;\n    }\n\n    loadScript() {\n        const script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.src = this._url;\n        script.onreadystatechange = this._callback;\n        script.onload = this._callback;\n\n        document.body.appendChild(script);\n    }\n}\n\nexport default ScriptLoad;\n","import HelperElement from './helper-element.js';\nimport Manifest from './manifest.js';\nimport Helper from './helper.js';\nimport IcaJson from './ica-json.js';\nimport ScriptLoad from './script-load.js';\n\nwindow.launchHelper = function () {\n    const loadCitrixSDKPromise = new Promise(resolve => {\n        new ScriptLoad(`${new Manifest().manifest.staticResource}/CitrixHTML5SDK.js`, () => {\n            resolve();\n        }).loadScript();\n    });\n    \n\n    const getIcaJsonPromise = new IcaJson().icaAsync;\n\n    Promise.all([loadCitrixSDKPromise, getIcaJsonPromise])\n        .then(results => {\n            const ica = results[1];\n            const launchHelperElement = new HelperElement();\n            launchHelperElement.appendIframe();\n        \n            const helper = new Helper(ica);\n            helper.createSession();\n        }).catch(err => {\n            console.log(err);\n        });\n};\n"],"sourceRoot":""}